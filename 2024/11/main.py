# https://adventofcode.com/2024/day/11
#%% ----------- SETUP -------------------------
from collections import Counter, defaultdict
import os
from sys import path as SYSPATH

from functools import lru_cache
from typing import Iterable

script_path = os.path.dirname(os.path.abspath(__file__))

SYSPATH.append(os.path.join(script_path, '..'))
from utils import load_data, execute_function

#% --------- THE IMPORTANT STUFF -------------

FILENAME = 'example_input.txt'
FILENAME = 'input.txt'
file_path = os.path.join(script_path, FILENAME)


def splitter(value: int, split_index: int) -> tuple[int,int]:
    """ Split stone in half 123678 -> 123, 678
    """
    value_str = str(value)
    return (
        int(value_str[split_index:]),
        int(value_str[:split_index]) 
    )

@lru_cache(maxsize=10_000)
def transform(value: int) -> tuple[int]:
    """ The thing that happens to each stone after a blink
    """
    if value == 0:
        return (1, )
    length = len(str(value))
    if length % 2 == 0:
        return splitter(value, length//2)
    return (value*2024, )


def main(n_blinks: int) -> int:
    transform.cache_clear()
    data = map(int, load_data(file_path).strip().split())
    
    # 'ORdEr iS pReSerVeD' - Yeah, sure...
    stones = Counter(data)
        
    for _ in range(n_blinks):
        created_stones = defaultdict(int)
        for stone in stones:
            for new_stone in transform(stone):
                created_stones[new_stone] += stones[stone]
        stones = created_stones
    
    return sum(stones.values())

    
def task_1():
    return main(25)

def task_2():
    return main(75)

    


#% -------------------------------------------

if __name__ == "__main__":
    do_timing = False
    execute_function(
        task_1,
        args = {},
        do_timing = do_timing
    )
    
    execute_function(
        task_2,
        args = {},
        do_timing = do_timing
    )
    
    execute_function(
        main,
        args = {'n_blinks': 10_000},
        do_timing = do_timing
    )
    
# Function: task_1
# 	Result: 193607
# 	Average exec time: 5.5785 ms.
# Function: task_2
# 	Result: 229557103025807
# 	Average exec time: 126.3002 ms.


## Just for fun

# Function: main(n_blinks=10000)
# 	Result: 12935815257023474145653686465629901797298042966373844041037689518695998845837878009185625580948304093370681407296008371145277513095713286554603046587230305058290453276718500855449822326940603610083587987221414735102558390004361101729898109344450402649843042086147657001565100035092885290639077247863105668579980655605289285646762741193744869682269018207879688209675777083967825025192604606095003551629202151342641137110408155829615903146309633190901767835804735982001804500913823504799791514548546856032300716851403020137314184304509626251435806595078090806188253391821090010014255008758339386768758153737886713997866188053343252416177554225684529928829981091501862799805467740014829637760570592494155753029557699818885613113237437310934882798712442863018738347154068083818916793768823356099960461924027154206732681221071223998268641968747482025178890945833514134078302567836273915893880367441363312616613831198178890043917370017707956557654079270143319474790203695886161357023531308482810008130352112170470286808955958404363971456834563932232322225647197376341546863906335712174006940524547196161056307097500430009100905100758616138573387339565356921273164624620655221582788420015204558627238679474193656141119062187676234328134754854674863348864527285401595464170736469084235193073034905034244313132090901870160056134202625742940717355184544624049085696154501295326011525908982724408133401612796088298498881876738430614461148416593170201881387590398616584297914603736290039472759306539583174278274461719836362250729003228175820665969534156400515239014666635101249214503986866747935267803815373160429731155464441925215222626312277000718893787405510689049689545989697263550069530140455293807676364785149426905600034436108237566493758302667009144141723182381275416338501649951136120055722395461990486635703180045390048
# 	Execution time: 46.8507 s.